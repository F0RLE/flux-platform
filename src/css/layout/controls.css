/* App Header (Glass Panel) */
#app-header {
    position: fixed;
    top: 0;
    right: 0;
    left: var(--sidebar-width, 280px);
    height: 60px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 1.5rem;
    /* Left padding matches sidebar align */
    padding-right: 20px;
    /* Specific right padding for controls */
    z-index: 900;

    /* Liquid Glass Effect */
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);

    /* Glossy gradient + dark tint */
    background: linear-gradient(135deg,
            rgba(255, 255, 255, 0.05) 0%,
            rgba(255, 255, 255, 0.01) 50%,
            rgba(0, 0, 0, 0.2) 100%);

    /* Depth and Edges */
    box-shadow:
        inset 0 1px 0 0 rgba(255, 255, 255, 0.1),
        /* Top highlight */
        inset 0 -1px 0 0 rgba(255, 255, 255, 0.05),
        /* Bottom subtle rim */
        0 4px 20px rgba(0, 0, 0, 0.2);
    /* Drop shadow */

    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    /* Subtle border */
    transition: none;
    -webkit-app-region: drag;
}

body.snapping #app-header {
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Top Right Controls (now inside header) */
.top-controls {
    display: flex;
    gap: 12px;
    /* Consistent gap between buttons */
    padding-right: 4px;
    /* Tiny adjustment for visual balance */
    -webkit-app-region: no-drag;
    transition: filter 0.3s ease;
    filter: blur(0px);
    transform: translateZ(0);
}

.window-control-btn {
    background: transparent;
    border: none;
    border-radius: 8px;
    /* Slightly tighter radius */
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    /* Keep click target large */
    height: 32px;
    /* Shorter height to fit header better */
    font-size: 1.2rem;
    transition: all 0.2s;
    color: var(--text-secondary);
    /* -webkit-app-region: no-drag; -> handled by parent container */
}

.window-control-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    transform: none;
    /* simple highlight */
}

.window-control-btn:active {
    background: rgba(255, 255, 255, 0.15);
}

.close-btn {
    background: transparent;
    border: none;
    border-radius: 8px;
    padding: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 32px;
    font-size: 1.2rem;
    transition: all 0.2s;
    color: var(--text-secondary);
    /* -webkit-app-region: no-drag; -> handled by parent container */
}

.close-btn:hover {
    background: var(--danger);
    color: white;
    box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
}

.close-btn:active {
    transform: scale(0.95);
}

/* Language Switcher - Slide Out Redesign (now inside header) */
.lang-switcher-root {
    position: relative;
    /* Changed from fixed */
    top: auto;
    left: auto;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    /* Align left */
    z-index: 1000;
    -webkit-app-region: no-drag;
    /* Buttons must be clickable */
}

/* Removed specific body.snapping rule for lang-switcher as parent handles it */



.lang-menu-items {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 0.5rem;
    padding-left: 0.5rem;

    /* Animation State: Hidden */
    opacity: 0;
    visibility: hidden;
    transform: translateX(0);
    transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);

    /* Layout */
    position: absolute;
    left: 100%;
    top: 0;
    height: 100%;
    white-space: nowrap;
}

.lang-menu-items.open {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
}

/* Common Button Styles */
.lang-btn {
    background: rgba(30, 30, 30, 0.6);
    border: none;
    /* No border as requested */
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;

    /* Squircle Shape */
    width: 36px;
    height: 36px;
    border-radius: 10px;
    /* Squircle-ish */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.lang-btn:hover {
    background: rgba(50, 50, 50, 0.8);
    transform: translateY(-1px);
    color: var(--text-primary);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

.lang-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Main Trigger Button specific styles */
.current-lang-trigger {
    z-index: 2;
    background: rgba(40, 40, 40, 0.8);
}

.current-lang-trigger:hover {
    background: rgba(60, 60, 60, 0.9);
}

.lang-btn .flag-icon {
    margin: 0;
    display: block;
    width: 24px;
    height: 18px;
    border-radius: 3px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Flag icons (SVG, avoids OS emoji font issues showing GB/RU as text) */
.flag-icon {
    width: 26px;
    height: 19.5px;
    border-radius: 4px;
    overflow: hidden;
    display: inline-block;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
    flex-shrink: 0;
}

.flag-gb {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 30'%3E%3Crect width='50' height='30' fill='%23012169'/%3E%3Cpath d='M0 0 L50 30 M50 0 L0 30' stroke='%23FFFFFF' stroke-width='6'/%3E%3Cpath d='M0 0 L50 30 M50 0 L0 30' stroke='%23C8102E' stroke-width='4'/%3E%3Cpath d='M25 0 V30 M0 15 H50' stroke='%23FFFFFF' stroke-width='10'/%3E%3Cpath d='M25 0 V30 M0 15 H50' stroke='%23C8102E' stroke-width='6'/%3E%3C/svg%3E");
}

.flag-ru {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3 2'%3E%3Crect width='3' height='0.6667' y='0' fill='%23FFFFFF'/%3E%3Crect width='3' height='0.6667' y='0.6667' fill='%230039A6'/%3E%3Crect width='3' height='0.6667' y='1.3333' fill='%23D52B1E'/%3E%3C/svg%3E");
}

.flag-cn {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'%3E%3Crect width='900' height='600' fill='%23DE2910'/%3E%3Cpath d='M128.4 122.9L161.9 226l-87.7-63.7h108.4L94.7 226l33.7-103.1z' fill='%23FFDE00'/%3E%3Cg transform='translate(300 120)'%3E%3Cpath d='M30.6 6.6L45.4 39 12 21.8h41.4L18.6 39 33.4 6.7z' fill='%23FFDE00' transform='rotate(23)'/%3E%3C/g%3E%3Cg transform='translate(360 210)'%3E%3Cpath d='M30.6 6.6L45.4 39 12 21.8h41.4L18.6 39 33.4 6.7z' fill='%23FFDE00' transform='rotate(46)'/%3E%3C/g%3E%3Cg transform='translate(360 330)'%3E%3Cpath d='M30.6 6.6L45.4 39 12 21.8h41.4L18.6 39 33.4 6.7z' fill='%23FFDE00' transform='rotate(70)'/%3E%3C/g%3E%3Cg transform='translate(300 420)'%3E%3Cpath d='M30.6 6.6L45.4 39 12 21.8h41.4L18.6 39 33.4 6.7z' fill='%23FFDE00' transform='rotate(93)'/%3E%3C/g%3E%3C/svg%3E");
}

.lang-option .flag-icon {
    margin: 0;
    display: block !important;
}

.lang-dropdown-btn .flag-icon {
    display: inline-block !important;
    visibility: visible !important;
    opacity: 1 !important;
    width: 24px !important;
    height: 18px !important;
}

.lang-dropdown-btn[data-lang="en"] .flag-gb {
    display: inline-block !important;
}

.lang-dropdown-btn[data-lang="ru"] .flag-ru {
    display: inline-block !important;
}

.lang-dropdown-btn[data-lang="zh"] .flag-cn {
    display: inline-block !important;
}